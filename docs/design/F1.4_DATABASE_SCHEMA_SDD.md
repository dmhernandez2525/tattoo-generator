# Software Design Document - F1.4 Database Schema

**Version:** 1.0.0
**Status:** ðŸŸ¨ In Progress
**Last Updated:** 2026-02-03

## 1. Overview

### Purpose
Define the initial PostgreSQL schema for INK SYNTHESIS, covering users, designs, style presets, collections, and commissions.

### Goals
- Provide normalized schema for core entities.
- Support future expansion for marketplace and artist features.
- Align with Clerk authentication by storing `clerkId`.

### Non-Goals
- Payment or subscription tables (Phase 7).
- Analytics and telemetry schema (Phase 10).

## 2. Entity Model

### User
Represents an authenticated account.

**Fields**
- `id` (UUID, PK)
- `clerkId` (string, unique)
- `email` (string, unique)
- `displayName` (string)
- `role` (enum: USER, ARTIST, ADMIN)
- `avatarUrl` (string, nullable)
- `onboardingCompleted` (boolean)
- `createdAt`, `updatedAt` (timestamps)

### Design
Represents a generated or uploaded tattoo design.

**Fields**
- `id` (UUID, PK)
- `userId` (FK â†’ User)
- `title` (string)
- `prompt` (string)
- `style` (enum: CYBERPUNK, TRADITIONAL, MINIMALIST, GEOMETRIC, WATERCOLOR, TRIBAL, JAPANESE)
- `imageUrl` (string)
- `thumbnailUrl` (string, nullable)
- `isFavorite` (boolean)
- `createdAt`, `updatedAt` (timestamps)

### StylePreset
Represents a reusable style configuration.

**Fields**
- `id` (UUID, PK)
- `name` (string, unique)
- `description` (string)
- `keywords` (string array)
- `isActive` (boolean)

### Collection
User-managed design collections.

**Fields**
- `id` (UUID, PK)
- `userId` (FK â†’ User)
- `name` (string)
- `description` (string, nullable)
- `createdAt`, `updatedAt` (timestamps)

### CollectionItem
Join table between `Collection` and `Design`.

**Fields**
- `collectionId` (FK â†’ Collection)
- `designId` (FK â†’ Design)
- `createdAt` (timestamp)

### Commission
Represents a custom design request.

**Fields**
- `id` (UUID, PK)
- `requesterId` (FK â†’ User)
- `artistId` (FK â†’ User, nullable)
- `status` (enum: OPEN, IN_PROGRESS, REVIEW, COMPLETED, CANCELED)
- `brief` (string)
- `budgetCents` (int)
- `createdAt`, `updatedAt` (timestamps)

## 3. Prisma Schema Outline

- Use `@id @default(uuid())` for primary keys.
- Use `@updatedAt` for `updatedAt`.
- Enforce unique indexes on `clerkId` and `email`.
- Model enums for `UserRole`, `TattooStyle`, and `CommissionStatus`.

## 4. Migration Strategy

- Initial migration adds all tables in one batch.
- Backfill scripts are not required for greenfield launch.

## 5. Testing & Validation

- Prisma migrations run in CI with `prisma migrate deploy`.
- Basic CRUD tests for each model.
